<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Kết quả làm bài</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f8ff; }
    h2 { color: #2c3e50; }
    .summary { margin-bottom: 20px; font-size: 18px; }
    .question { margin-bottom: 20px; padding: 12px; background: #fff; border-left: 6px solid #ccc; border-radius: 8px; }
    .correct { border-left-color: #2ecc71; background: #f6fff8; }
    .wrong { border-left-color: #e74c3c; background: #fff6f6; }
    .unanswered { border-left-color: #7f8c8d; background: #f0f0f0; }
    .answer { margin-left: 10px; line-height: 1.5; }
    .answer.right { font-weight: 700; color: #2ecc71; }
    .answer.chosen-wrong { color: #e74c3c; text-decoration: underline; }
    .noti { font-style: italic; color: #7f8c8d; margin-top: 6px; }
    button { padding: 10px 16px; border-radius: 6px; border:none; background:#007bff; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <h2 id="deTitle">📋 Kết quả bài làm</h2>
  <div class="summary">
    <p id="diemSo"></p>
    <p id="soCauDung"></p>
  </div>
  <div id="chiTietCauHoi"></div>
  <button onclick="location.href='lb.html'">🔄 Làm lại</button>

<script>
const ketQua = JSON.parse(localStorage.getItem('ketQua'));
if(!ketQua){
  alert("Không tìm thấy dữ liệu kết quả!");
  location.href='index.html';
}

document.getElementById('deTitle').textContent = `📋 Kết quả: ${ketQua.ten_de ?? ''}`;
document.getElementById('diemSo').textContent = `Điểm: ${ketQua.diem} / 10`;
document.getElementById('soCauDung').textContent = `Số câu đúng: ${ketQua.cauhoi.filter(q=>q.da_chon_letter===q.dapan_dung_letter).length} / ${ketQua.cauhoi.length}`;

const container = document.getElementById('chiTietCauHoi');

ketQua.cauhoi.forEach((q,i)=>{
  const div = document.createElement('div');
  let statusClass='unanswered';
  if(q.da_chon_letter){
    statusClass = q.da_chon_letter===q.dapan_dung_letter ? 'correct' : 'wrong';
  }
  div.className='question '+statusClass;

  const choiceHTML = q.choices.map(ch=>{
    let cls=[];
    if(ch.label===q.dapan_dung_letter) cls.push('right');
    if(ch.label===q.da_chon_letter && ch.label!==q.dapan_dung_letter) cls.push('chosen-wrong');
    return `<span class="answer ${cls.join(' ')}">${ch.label}. ${ch.text}</span><br>`;
  }).join('');

  div.innerHTML = `<strong>Câu ${i+1}: ${q.noi_dung}</strong><br>${choiceHTML}`;
  container.appendChild(div);
});
</script>
</body>
</html>
