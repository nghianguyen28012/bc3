<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang Há»c Sinh</title>
  <link rel="stylesheet" href="stylehs.css">
  <style>
    .hidden { display: none; }
    .card-btn {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .card-btn:hover { background: #0056b3; }
    .card-section { margin-top: 20px; }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Onluyen Logo" class="logo">
    <nav>
      <a href="#">Tin tá»©c</a>
      <a href="#">Ká»³ thi</a>
      <a href="#">Há»c phÃ­</a>
      <a href="#">Flashcard</a>
      <a href="#">Tuyá»ƒn dá»¥ng</a>
    </nav>
  </header>

  <main class="dashboard">
    <section class="welcome">
      <h1>ChÃ o má»«ng, <span id="studentName">Há»c sinh</span> ğŸ‘‹</h1>
      <p>HÃ£y chá»n má»™t hÃ nh Ä‘á»™ng bÃªn dÆ°á»›i Ä‘á»ƒ báº¯t Ä‘áº§u há»c táº­p.</p>
    </section>

    <section class="actions">
      <button class="action-btn" onclick="showSubjects()">ğŸ“š LÃ m bÃ i tráº¯c nghiá»‡m</button>
      <button class="action-btn" onclick="viewResults()">ğŸ“Š Xem káº¿t quáº£</button>
    </section>

    <section id="subjectList" class="card-section hidden">
      <h2>ğŸ§  Chá»n mÃ´n há»c</h2>
      <div class="card-container" id="subjects"></div>
    </section>

    <section id="classList" class="card-section hidden">
      <h2>ğŸ« Chá»n lá»›p há»c</h2>
      <div class="card-container" id="classes"></div>
    </section>

    <section id="examList" class="card-section hidden">
      <h2>ğŸ“ Chá»n bÃ i kiá»ƒm tra</h2>
      <div class="card-container" id="exams"></div>
    </section>
  </main>

  <script>
    // Hiá»ƒn thá»‹ tÃªn há»c sinh
    const user = JSON.parse(localStorage.getItem("user"));
    document.getElementById("studentName").textContent = user?.ho_ten || "Há»c sinh";

    // âœ… Thá»© tá»± mÃ´n há»c theo yÃªu cáº§u
    const subjects = [
      "ToÃ¡n", "VÄƒn", "Anh", "Sá»­", "Äá»‹a", "Sinh", "Tin há»c", "Váº­t lÃ½", "HÃ³a há»c"
    ];

    const classes = Array.from({ length: 12 }, (_, i) => `Lá»›p ${i + 1}`);

    function showSubjects() {
      document.getElementById("subjectList").classList.remove("hidden");
      document.getElementById("classList").classList.add("hidden");
      document.getElementById("examList").classList.add("hidden");

      const container = document.getElementById("subjects");
      container.innerHTML = "";
      subjects.forEach(mon => {
        const btn = document.createElement("button");
        btn.textContent = mon;
        btn.className = "card-btn";
        btn.onclick = () => selectSubject(mon);
        container.appendChild(btn);
      });
    }

    function selectSubject(mon) {
      localStorage.setItem("selectedMon", mon);
      document.getElementById("classList").classList.remove("hidden");
      document.getElementById("examList").classList.add("hidden");

      const container = document.getElementById("classes");
      container.innerHTML = "";

      let filteredClasses = classes;
      if (mon === "Váº­t lÃ½" || mon === "HÃ³a há»c") {
        // âœ… Chá»‰ hiá»ƒn thá»‹ tá»« lá»›p 8 trá»Ÿ lÃªn
        filteredClasses = classes.slice(7); // Lá»›p 8 -> 12
      }

      filteredClasses.forEach(lop => {
        const btn = document.createElement("button");
        btn.textContent = lop;
        btn.className = "card-btn";
        btn.onclick = () => selectClass(lop.replace("Lá»›p ", ""));
        container.appendChild(btn);
      });
    }

    function selectClass(lop_id) {
      localStorage.setItem("selectedLop", lop_id);
      document.getElementById("examList").classList.remove("hidden");

      const container = document.getElementById("exams");
      container.innerHTML = "";
      [1, 2, 3].forEach(soDe => {
        const btn = document.createElement("button");
        btn.textContent = `Äá» sá»‘ ${soDe}`;
        btn.className = "card-btn";
        btn.onclick = () => loadExam(soDe);
        container.appendChild(btn);
      });
    }

    function loadExam(soDe) {
      const mon = localStorage.getItem("selectedMon");
      const lop = localStorage.getItem("selectedLop");

      // âœ… Map mÃ´n há»c sang ID chuáº©n
     const monhocMap = {
  "ToÃ¡n": 1,
  "VÄƒn": 2,
  "Anh": 3,
  "Sá»­": 4,
  "Äá»‹a": 5,
  "Sinh": 6,
  "GDCD": 7,
  "Tin há»c": 8,
  "Váº­t lÃ½": 9,
  "HÃ³a há»c": 10
};

      const monhoc_id = monhocMap[mon];

      fetch(`layde.php?monhoc_id=${monhoc_id}&lop_id=${lop}&sode=${soDe}`)
        .then(res => res.json())
        .then(data => {
          if (!data || !data.cauHoi || data.cauHoi.length === 0) {
            alert("Äá» thi khÃ´ng kháº£ dá»¥ng. Vui lÃ²ng chá»n Ä‘á» khÃ¡c.");
            return;
          }

          const cauhoi_json = data.cauHoi.map(q => ({
            id: q.id,
            noi_dung: q.noi_dung,
            dapan: [q.dapan_a, q.dapan_b, q.dapan_c, q.dapan_d],
            dapan_dung: parseInt(q.dapan_dung)
          }));

          const deThi = {
            ten_de: data.ten_de,
            cauhoi_json: cauhoi_json
          };

          localStorage.setItem("deThi", JSON.stringify(deThi));
          window.location.href = "lb.html";
        })
        .catch(err => {
          console.error("Lá»—i táº£i Ä‘á»:", err);
          alert("KhÃ´ng thá»ƒ táº£i Ä‘á» thi. Vui lÃ²ng thá»­ láº¡i.");
        });
    }

    function viewResults() {
      window.location.href = "xemketqua.html";
    }
  </script>
</body>
</html>
