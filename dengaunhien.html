<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Xem trước đề ngẫu nhiên</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Roboto', sans-serif;
  margin: 0; padding: 0;
  background: #f7f9fc;
}
header {
  background: #4f46e5;
  color: #fff;
  padding: 15px 30px;
  font-size: 20px;
  font-weight: bold;
}
.container {
  max-width: 1100px;
  margin: 20px auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
h1 {
  text-align: center;
  margin-bottom: 10px;
  color: #333;
}
#examInfo {
  text-align: center;
  font-size: 18px;
  color: #666;
  margin-bottom: 20px;
}
.question-list {
  max-height: 500px;
  overflow-y: auto;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 10px;
}
.question {
  background: #f9fafb;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 15px;
  transition: 0.3s;
}
.question:hover {
  background: #eef2ff;
}
.actions {
  text-align: center;
  margin-top: 20px;
}
button {
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  margin: 0 10px;
  transition: 0.3s;
}
button:hover {
  opacity: 0.9;
}
.confirm {
  background: linear-gradient(45deg, #4f46e5, #6366f1);
  color: #fff;
}
.cancel {
  background: #e11d48;
  color: #fff;
}
</style>
</head>
<body>
<header>Onluyen Edmicro - Xem trước đề ngẫu nhiên</header>
<div class="container">
  <h1>🎲 Đề ngẫu nhiên</h1>
  <p id="examInfo">Đang tải câu hỏi...</p>
  <div class="question-list" id="questionList"></div>
  <div class="actions">
    <button class="confirm" onclick="confirmRandom()">✅ Xác nhận</button>
    <button class="cancel" onclick="window.history.back()">🔙 Quay lại</button>
  </div>
</div>

<script>
fetch('gvchoncautaodengaunhien.php')
.then(res => res.json())
.then(data => {
  if(!data || data.length===0){
    alert("Không có câu hỏi trong DB");
    return;
  }
  const randomQuestions = data.sort(()=>0.5-Math.random()).slice(0,20);
  document.getElementById('examInfo').textContent = `Đề gồm ${randomQuestions.length} câu hỏi.`;

  const container = document.getElementById('questionList');
  randomQuestions.forEach((q,i)=>{
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `<strong>Câu ${i+1}:</strong> ${q.noi_dung}
      <ul>
        <li>A. ${q.dapan_a}</li>
        <li>B. ${q.dapan_b}</li>
        <li>C. ${q.dapan_c}</li>
        <li>D. ${q.dapan_d}</li>
      </ul>`;
    container.appendChild(div);
  });

  localStorage.setItem('tempRandomExam', JSON.stringify(randomQuestions));
});

function confirmRandom(){
  const randomExam = localStorage.getItem('tempRandomExam');
  if(!randomExam){ alert("Không có đề để xác nhận!"); return; }
  const deThi = { ten_de: "Đề ngẫu nhiên", cauhoi_json: JSON.parse(randomExam) };
  localStorage.setItem('deThi', JSON.stringify(deThi));
  alert("Đề ngẫu nhiên đã tạo thành công!");
  window.location.href = "lb.html";
}
</script>
</body>
</html>
